<h2>石巻PersonFinder避難者連携</h2>
<%= form_for @search, :url => linkages_search_path, :html => {:method => :get} do |f| %>
  <%= hidden_field_tag "commit_kind" %>
  <%= hidden_field_tag "link_evacuees" %>
  <fieldset class="collapsible tabular">
    <legend id="linkages_search_conditions" onclick="toggleFieldset(this);">検索条件</legend>
    <div style="">
      <div class="splitcontentleft">
        <p>
          <label style="font-weight: normal">氏名カナ</label>
          <%= f.text_field :alternate_family_name_or_alternate_given_name_like,
          :size => 55 %>
        </p>
        <p>
          <label style="font-weight: normal">地区名</label>
          <%= f.select(:shelter_name_sw,
          options_for_select(@area.invert,
          @search.shelter_name_sw),
          { :include_blank => true }) %>
        </p>
        <p>
          <label style="font-weight: normal">連携状況</label>
          <%= f.select(:linked_flag_eq,
          options_for_select(@evacuee_const["linked_flag"].invert,
          @search.linked_flag_eq),
          { :include_blank => true }) %>
        </p>
      </div>
      <div class="splitcontentright">
        <p>
          <label style="font-weight: normal">生年月日</label>
          <%= f.text_field :date_of_birth_gte, :size => 20 %> ～
          <%= f.text_field :date_of_birth_lte, :size => 20 %>
        </p>
        <p>
          <label style="font-weight: normal">避難所名</label>
          <%= f.select(:shelter_name_eq,
          options_for_select(@shelter.invert,
          @search.shelter_name_eq),
          { :include_blank => true }) %>
        </p>
        <p>
          <label style="font-weight: normal">住基マッチング</label>
          <%= f.select(:juki_status_eq,
          options_for_select(@evacuee_const["juki_status"].invert,
          @search.juki_status_eq),
          { :include_blank => true }) %>
        </p>
      </div>
  
      <p style="clear: left; margin-left: -28px;">
        <label class="floating">負傷
          <%= f.select(:injury_flag_eq,
          options_for_select(@evacuee_const["injury_flag"].invert,
          @search.injury_flag_eq),
          { :include_blank => true }) %>
        </label>
        <label class="floating">アレルギー
          <%= f.select(:allergy_flag_eq,
          options_for_select(@evacuee_const["allergy_flag"].invert,
          @search.allergy_flag_eq),
          { :include_blank => true }) %>
        </label>
      </p>
  
      <p style="margin-left: -28px;">
        <label class="floating">妊婦
          <%= f.select(:pregnancy_eq,
          options_for_select(@evacuee_const["pregnancy"].invert,
          @search.pregnancy_eq),
          { :include_blank => true }) %>
        </label>
        <label class="floating">乳幼児
          <%= f.select(:baby_eq,
          options_for_select(@evacuee_const["baby"].invert,
          @search.baby_eq),
          { :include_blank => true }) %>
        </label>
        <label class="floating">要介護度3以上
          <%= f.select(:upper_care_level_three_eq,
          options_for_select(@evacuee_const["upper_care_level_three"].invert,
          @search.upper_care_level_three_eq),
          { :include_blank => true }) %>
        </label>
      </p>
  
      <p style="margin-left: -146px;">
        <label class="floating">一人暮らし高齢者（65歳以上）
          <%= f.select(:elderly_alone_eq,
          options_for_select(@evacuee_const["elderly_alone"].invert,
          @search.elderly_alone_eq),
          { :include_blank => true }) %>
        </label>
        <label class="floating">高齢者世帯（夫婦共に65歳以上）
          <%= f.select(:elderly_couple_eq,
          options_for_select(@evacuee_const["elderly_couple"].invert,
          @search.elderly_couple_eq),
          { :include_blank => true }) %>
        </label>
        <label class="floating">寝たきり高齢者
          <%= f.select(:bedridden_elderly_eq,
          options_for_select(@evacuee_const["bedridden_elderly"].invert,
          @search.bedridden_elderly_eq),
          { :include_blank => true }) %>
        </label>
      </p>
  
      <p style="margin-left: -71px;">
        <label class="floating">認知症高齢者
          <%= f.select(:elderly_dementia_eq,
          options_for_select(@evacuee_const["elderly_dementia"].invert,
          @search.elderly_dementia_eq),
          { :include_blank => true }) %>
        </label>
        <label class="floating">療育手帳所持者
          <%= f.select(:rehabilitation_certificate_eq,
          options_for_select(@evacuee_const["rehabilitation_certificate"].invert,
          @search.rehabilitation_certificate_eq),
          { :include_blank => true }) %>
        </label>
        <label class="floating">身体障害者手帳所持者
          <%= f.select(:physical_disability_certificate_eq,
          options_for_select(@evacuee_const["physical_disability_certificate"].invert,
          @search.physical_disability_certificate_eq),
          { :include_blank => true }) %>
        </label>
      </p>
  
      <p>
        <label style="font-weight: normal">備考</label>
        <%= f.text_field :note_like, :size => 120 %>
      </p>
      
      <%= f.submit '検索', :kind => "search" %>
      <input type="button" value="クリア" id="clear_button">
    </div>
  </fieldset>
  
  <div class="splitcontentright">
    <p class="set_right">
      <%= f.submit '出力', :kind => "link", :id => "link_button" %>
      <%= f.submit '一括出力', :kind => "bulk_link" %>
    </p>
    <p class="set_right">
      <%= will_paginate @evacuees, :previous_label => "前 &lt;&lt; ",
        :next_label => " &gt;&gt; 次", :page_links => false,
        :link_separator => "#{page_entries_info @evacuees}",
        :container => false %>
    </p>
  </div>
<% end %>

<table class="list">
  <thead>
    <tr>
      <th class="set_center">氏名</th>
      <th class="set_center">氏名カナ</th>
      <th class="set_center">住所</th>
      <th class="set_center">市内・市外区分</th>
      <th class="set_center">生年月日</th>
      <th class="set_center">避難所名</th>
      <th class="set_center">備考</th>
      <th class="set_center">住基マッチング</th>
      <th class="set_center">連携状況</th>
      <th class="set_center">連携者名</th>
      <th class="set_center">連携日</th>
      <th class="set_center">連携</th>
    </tr>
  </thead>
  <tbody>
    <% @evacuees.each do |evacuee| %>
      <tr class="<%= cycle("even", "odd") -%>">
        <td class="set_center">
          <%= "#{evacuee.family_name} #{evacuee.given_name}" %>
        </td>
        <td class="set_center">
          <%= "#{evacuee.alternate_family_name} #{evacuee.alternate_given_name}" %>
        </td>
        <td class="set_center">
          <%= "#{@state[evacuee.home_state]}#{evacuee.home_city}#{evacuee.home_street}#{evacuee.house_number}" %>
        </td>
        <td class="set_center">
          <%= @evacuee_const["in_city_flag"]["#{evacuee.in_city_flag}"] %>
        </td>
        <td class="set_center">
          <%= l(evacuee.date_of_birth) if evacuee.date_of_birth.present? %>
        </td>
        <td class="set_center">
          <%= @shelter[evacuee.shelter_name] %>
        </td>
        <td class="set_center">
          <%= evacuee.note %>
        </td>
        <td class="set_center">
          <%= @evacuee_const["juki_status"]["#{evacuee.juki_status}"] %>
        </td>
        <td class="set_center">
          <%= @evacuee_const["linked_flag"]["#{evacuee.linked_flag}"] %>
        </td>
        <td class="set_center">
          <%= evacuee.linked_by %>
        </td>
        <td class="set_center">
          <%= l(evacuee.linked_at.to_date) if evacuee.linked_at.present? %>
        </td>
        <td class="set_center">
          <%= check_box_tag "link_evacuee", evacuee.id %>
        </td>
      </tr>
    <% end if @evacuees.present? %>
  </tbody>
</table>

<%= javascript_tag do %>
  $(document).ready(function() {
    // 検索条件を初期表示時に非表示にする
    $("#linkages_search_conditions").click();
  });
<% end %>